<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="A secure, encrypted journaling app with task management and calendar features">
    <title>Mynder - Journaling App</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.min.js"></script>
</head>
<body>
    <!-- Password Lock Screen -->
    <div id="lock-screen" class="lock-screen">
        <div class="lock-container">
            <h1>ðŸ”’ Mynder</h1>
            <p class="lock-subtitle">Secure Personal Journal</p>
            <div id="setup-password" class="password-form">
                <h3>Set Your Password</h3>
                <p class="info-text">Create a password to encrypt your data. <strong>Don't forget it!</strong> Your data cannot be recovered without it.</p>
                <input type="password" id="new-password" placeholder="Create password" />
                <input type="password" id="confirm-password" placeholder="Confirm password" />
                <button id="setup-btn" class="btn-primary">Set Password</button>
            </div>
            <div id="unlock-password" class="password-form" style="display: none;">
                <h3>Welcome Back</h3>
                <p class="info-text">Enter your password to unlock your journal</p>
                <input type="password" id="unlock-password-input" placeholder="Enter password" />
                <button id="unlock-btn" class="btn-primary">Unlock</button>
                <div id="unlock-error" class="error-message"></div>
            </div>
        </div>
    </div>

    <div class="container" style="display: none;">
        <header>
            <div class="header-content">
                <div>
                    <h1>Mynder</h1>
                    <p class="subtitle">Your Personal Journal & Task Manager</p>
                </div>
                <div class="header-actions">
                    <button id="install-app-btn" class="install-btn" style="display: none;" title="Install App">Install</button>
                    <button id="lock-app-btn" class="lock-btn" title="Lock App">ðŸ”’</button>
                </div>
            </div>
        </header>

        <!-- Mini Calendar Widget -->
        <div class="mini-calendar">
            <div class="calendar-header">
                <button class="calendar-nav" id="prev-month">â€¹</button>
                <div class="calendar-month-year" id="current-month-year"></div>
                <button class="calendar-nav" id="next-month">â€º</button>
            </div>
            <div class="calendar-weekdays">
                <div class="weekday">Sun</div>
                <div class="weekday">Mon</div>
                <div class="weekday">Tue</div>
                <div class="weekday">Wed</div>
                <div class="weekday">Thu</div>
                <div class="weekday">Fri</div>
                <div class="weekday">Sat</div>
            </div>
            <div class="calendar-grid" id="calendar-grid">
                <!-- Calendar days will be generated here -->
            </div>
        </div>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="journal">Journal</button>
            <button class="tab-btn" data-tab="tasks">Tasks</button>
            <button class="tab-btn" data-tab="calendar">Calendar</button>
        </nav>

        <!-- Journal Tab -->
        <div id="journal" class="tab-content active">
            <div class="journal-section">
                <h2>Today's Journal</h2>
                <div class="journal-form">
                    <input type="text" id="journal-title" placeholder="Entry title (optional)" />
                    <textarea id="journal-entry" placeholder="Write your thoughts here..." rows="6"></textarea>
                    <button id="add-journal-btn" class="btn-primary">Add Entry</button>
                </div>
                <div id="journal-entries" class="entries-list">
                    <!-- Journal entries will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Tasks Tab -->
        <div id="tasks" class="tab-content">
            <div class="tasks-section">
                <h2>Tasks & To-Do Lists</h2>
                <div class="task-form">
                    <input type="text" id="task-input" placeholder="Add a new task..." />
                    <button id="add-task-btn" class="btn-primary">Add Task</button>
                </div>
                <div id="task-list" class="task-list">
                    <!-- Tasks will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content">
            <div class="calendar-section">
                <h2>Events Calendar</h2>
                <div class="event-form">
                    <input type="text" id="event-title" placeholder="Event title" />
                    <input type="datetime-local" id="event-date" />
                    <textarea id="event-description" placeholder="Event description (optional)" rows="2"></textarea>
                    <button id="add-event-btn" class="btn-primary">Add Event</button>
                </div>
                <div id="events-list" class="events-list">
                    <!-- Events will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Register Service Worker for PWA capabilities
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // Handle PWA install prompt
        let deferredPrompt;
        const installBtn = document.getElementById('install-app-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show the install button
            if (installBtn) {
                installBtn.style.display = 'block';
            }
        });

        // Handle install button click
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (!deferredPrompt) {
                    return;
                }

                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                } else {
                    console.log('User dismissed the install prompt');
                }
                
                deferredPrompt = null;
                installBtn.style.display = 'none';
            });
        }

        // Track if app was installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA installed successfully');
            deferredPrompt = null;
            if (installBtn) {
                installBtn.style.display = 'none';
            }
        });
    </script>
</body>
</html>
